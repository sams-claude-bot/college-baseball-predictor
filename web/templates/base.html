<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}College Baseball Predictor{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        :root {
            --maroon: #5D1725;
            --maroon-dark: #4a1120;
            --grey: #777777;
            --dark: #1a1a1a;
            --light-grey: #e9ecef;
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --bg-card-header: #ffffff;
            --text-primary: #212529;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --table-hover-bg: rgba(93, 23, 37, 0.05);
            --navbar-bg: #1a1a1a;
        }
        
        [data-theme="dark"] {
            --maroon: #8B3A4A;
            --maroon-dark: #5D1725;
            --grey: #aaaaaa;
            --dark: #e8e8e8;
            --light-grey: #2a2a3e;
            --bg-body: #1a1a2e;
            --bg-card: #16213e;
            --bg-card-header: #16213e;
            --text-primary: #e8e8e8;
            --text-muted: #9a9ab0;
            --border-color: #2a2a4e;
            --table-hover-bg: rgba(139, 58, 74, 0.15);
            --navbar-bg: #0f0f23;
        }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Navbar */
        .navbar {
            background-color: var(--navbar-bg) !important;
            padding: 0.75rem 1rem;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .navbar-brand .icon {
            color: #5D1725;
        }
        
        [data-theme="dark"] .navbar-brand .icon {
            color: #8B3A4A;
        }
        
        .navbar .nav-link {
            color: rgba(255,255,255,0.85) !important;
            padding: 0.5rem 1rem !important;
            border-radius: 6px;
            margin: 0 2px;
            transition: all 0.2s;
        }
        
        .navbar .nav-link:hover, .navbar .nav-link.active {
            background-color: #5D1725;
            color: white !important;
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
            background-color: var(--bg-card);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .card {
            box-shadow: 0 2px 12px rgba(0,0,0,0.3);
        }
        
        .card-header {
            background-color: var(--bg-card-header);
            border-bottom: 2px solid #5D1725;
            font-weight: 600;
            padding: 1rem 1.25rem;
            border-radius: 12px 12px 0 0 !important;
            color: var(--text-primary);
        }
        
        .card-header.bg-maroon {
            background-color: #5D1725 !important;
            color: white;
            border-bottom: none;
        }
        
        /* Tab links inside cards */
        .card .nav-link {
            color: var(--grey) !important;
            background-color: var(--light-grey);
            border: 1px solid var(--border-color);
        }
        .card .nav-link:hover { color: var(--maroon) !important; }
        .card .nav-link.active {
            color: white !important;
            background-color: #5D1725 !important;
            border-color: #5D1725;
        }
        
        /* Stats cards */
        .stat-card {
            text-align: center;
            padding: 1.5rem;
        }
        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--maroon);
            line-height: 1;
        }
        .stat-card .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        /* Tables */
        .table { margin-bottom: 0; color: var(--text-primary); }
        .table thead th {
            background-color: var(--light-grey);
            border-bottom: 2px solid #5D1725;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-primary);
        }
        .table-hover tbody tr:hover { background-color: var(--table-hover-bg); }
        .table .rank-col { width: 50px; text-align: center; font-weight: 700; color: var(--maroon); }
        
        [data-theme="dark"] .table { --bs-table-bg: transparent; --bs-table-color: var(--text-primary); }
        [data-theme="dark"] .table-light { --bs-table-bg: rgba(255,255,255,0.03); }
        
        /* Badges */
        .badge.bg-maroon { background-color: #5D1725 !important; }
        .badge.bg-success-soft { background-color: rgba(25, 135, 84, 0.1); color: #198754; }
        .badge.bg-danger-soft { background-color: rgba(220, 53, 69, 0.1); color: #dc3545; }
        
        /* Progress bars */
        .progress { height: 8px; border-radius: 4px; background-color: var(--light-grey); }
        .progress-bar { background-color: #5D1725; border-radius: 4px; }
        .progress-bar.bg-success { background-color: #198754 !important; }
        .progress-bar.bg-danger { background-color: #dc3545 !important; }
        
        /* Win probability */
        .win-prob { font-size: 1.5rem; font-weight: 700; }
        .win-prob.high { color: #198754; }
        .win-prob.medium { color: var(--grey); }
        .win-prob.low { color: #dc3545; }
        
        /* Team links */
        a.team-link { color: var(--text-primary); text-decoration: none; font-weight: 500; }
        a.team-link:hover { color: var(--maroon); text-decoration: underline; }
        
        /* Value indicator */
        .value-indicator {
            display: inline-flex; align-items: center; gap: 0.5rem;
            padding: 0.25rem 0.75rem; border-radius: 20px; font-weight: 600; font-size: 0.85rem;
        }
        .value-indicator.positive { background-color: rgba(25, 135, 84, 0.15); color: #198754; }
        .value-indicator.negative { background-color: rgba(220, 53, 69, 0.15); color: #dc3545; }
        
        /* Edge bars */
        .edge-bar {
            height: 24px; border-radius: 4px; display: flex; align-items: center;
            justify-content: center; font-weight: 600; font-size: 0.8rem; color: white;
        }
        .edge-bar.positive { background: linear-gradient(90deg, #5D1725, #198754); }
        .edge-bar.negative { background: linear-gradient(90deg, #5D1725, #dc3545); }
        
        /* Sortable headers */
        th.sortable { cursor: pointer; user-select: none; }
        th.sortable:hover { background-color: var(--light-grey); }
        th.sortable::after { content: ' ↕'; opacity: 0.3; }
        th.sortable.asc::after { content: ' ↑'; opacity: 1; }
        th.sortable.desc::after { content: ' ↓'; opacity: 1; }
        
        /* Forms */
        .form-select, .form-control {
            border-radius: 8px; border: 2px solid var(--border-color); padding: 0.625rem 1rem;
            background-color: var(--bg-card); color: var(--text-primary);
        }
        .form-select:focus, .form-control:focus {
            border-color: #5D1725; box-shadow: 0 0 0 0.2rem rgba(93, 23, 37, 0.15);
        }
        .btn-maroon { background-color: #5D1725; border-color: #5D1725; color: white; }
        .btn-maroon:hover { background-color: #4a1120; border-color: #4a1120; color: white; }
        
        /* Game cards */
        .game-card { border-left: 4px solid #5D1725; }
        .game-time { font-size: 0.85rem; color: var(--text-muted); }
        
        /* Dark mode toggle */
        .dark-mode-toggle {
            background: none; border: none; color: rgba(255,255,255,0.85);
            font-size: 1.2rem; cursor: pointer; padding: 0.5rem;
        }
        .dark-mode-toggle:hover { color: white; }
        
        /* List group dark mode */
        [data-theme="dark"] .list-group-item {
            background-color: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        /* Accordion dark mode */
        [data-theme="dark"] .accordion-button {
            background-color: var(--bg-card);
            color: var(--text-primary);
        }
        [data-theme="dark"] .accordion-body {
            background-color: var(--bg-card);
            color: var(--text-primary);
        }
        
        /* Alert dark mode */
        [data-theme="dark"] .alert-secondary {
            background-color: var(--light-grey);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        /* Card footer dark mode */
        [data-theme="dark"] .card-footer {
            background-color: var(--bg-card);
            border-color: var(--border-color);
        }
        
        /* Text helpers */
        .text-muted { color: var(--text-muted) !important; }
        
        /* Mobile */
        @media (max-width: 768px) {
            .stat-card { padding: 1rem 0.5rem; }
            .stat-card .stat-value { font-size: 1.6rem; }
            .stat-card .stat-label { font-size: 0.75rem; }
            .table-responsive { font-size: 0.82rem; }
            .table-responsive th, .table-responsive td { padding: 0.4rem 0.35rem; white-space: nowrap; }
            .navbar-brand { font-size: 0.95rem; }
            .card { margin-bottom: 1rem; border-radius: 10px; }
            .card-header { padding: 0.75rem 1rem; font-size: 0.9rem; }
            .card-body { padding: 0.75rem; }
            .container { padding-left: 0.75rem; padding-right: 0.75rem; }
            h1.h3, .h3 { font-size: 1.3rem; }
            .display-4 { font-size: 2rem; }
            .btn-sm { font-size: 0.8rem; padding: 0.3rem 0.6rem; }
            .list-group-item { padding: 0.6rem 0.75rem; }
            /* Stack columns that are too wide */
            .col-md-4.text-center { margin-bottom: 0.5rem; }
            /* Hide less important table columns on mobile */
            .hide-mobile { display: none; }
            /* Prediction page mobile */
            .col-lg-4, .col-lg-8 { padding-left: 0; padding-right: 0; }
            /* Tighter spacing for value picks */
            .value-indicator { font-size: 0.75rem; padding: 0.15rem 0.5rem; }
        }
        
        /* Auburn theme */
        [data-team="auburn"] {
            --maroon: #0C2340;
            --maroon-dark: #091a2e;
        }
        [data-team="auburn"] .bg-maroon,
        [data-team="auburn"] .card-header.bg-maroon {
            background-color: #0C2340 !important;
        }
        [data-team="auburn"] .btn-maroon {
            background-color: #0C2340; border-color: #0C2340;
        }
        [data-team="auburn"] .btn-maroon:hover {
            background-color: #091a2e; border-color: #091a2e;
        }
        [data-team="auburn"] .navbar .nav-link:hover,
        [data-team="auburn"] .navbar .nav-link.active {
            background-color: #DD550C;
        }
        [data-team="auburn"] .stat-card .stat-value { color: #0C2340; }
        [data-team="auburn"] .card-header { border-bottom-color: #DD550C; }
        [data-team="auburn"] .table thead th { border-bottom-color: #DD550C; }
        [data-team="auburn"] .badge.bg-maroon { background-color: #DD550C !important; }
        [data-team="auburn"] a.team-link:hover { color: #DD550C; }
        [data-team="auburn"] .progress-bar { background-color: #0C2340; }
        [data-team="auburn"] .navbar-brand .icon { color: #DD550C; }
        [data-team="auburn"] .card .nav-link.active {
            background-color: #0C2340 !important; border-color: #0C2340;
        }
        /* Auburn dark mode combo */
        [data-team="auburn"][data-theme="dark"] {
            --maroon: #DD550C;
            --maroon-dark: #c44a0a;
            --bg-body: #0f1520;
            --bg-card: #162033;
            --bg-card-header: #162033;
            --light-grey: #1e2d45;
            --border-color: #2a3f5f;
        }
        [data-team="auburn"][data-theme="dark"] .bg-maroon,
        [data-team="auburn"][data-theme="dark"] .card-header.bg-maroon {
            background-color: #1a3158 !important;
            border-bottom: 2px solid #DD550C;
        }
        [data-team="auburn"][data-theme="dark"] .stat-card .stat-value { color: #DD550C; }
        [data-team="auburn"][data-theme="dark"] .btn-maroon {
            background-color: #DD550C; border-color: #DD550C; color: white;
        }
        [data-team="auburn"][data-theme="dark"] .btn-maroon:hover {
            background-color: #c44a0a; border-color: #c44a0a;
        }
        [data-team="auburn"][data-theme="dark"] .card-header { border-bottom-color: #DD550C; }
        [data-team="auburn"][data-theme="dark"] .table thead th { 
            border-bottom-color: #DD550C; background-color: #1e2d45;
        }
        [data-team="auburn"][data-theme="dark"] .badge.bg-maroon { background-color: #DD550C !important; }
        [data-team="auburn"][data-theme="dark"] a.team-link:hover { color: #DD550C; }
        [data-team="auburn"][data-theme="dark"] .navbar-brand .icon { color: #DD550C; }
        [data-team="auburn"][data-theme="dark"] .navbar .nav-link:hover,
        [data-team="auburn"][data-theme="dark"] .navbar .nav-link.active {
            background-color: #DD550C;
        }
        [data-team="auburn"][data-theme="dark"] .progress-bar { background-color: #DD550C; }
        [data-team="auburn"][data-theme="dark"] .card .nav-link.active {
            background-color: #DD550C !important; border-color: #DD550C;
        }
        
        /* MSU dark mode improvements */
        [data-team="mississippi-state"][data-theme="dark"] .stat-card .stat-value,
        [data-theme="dark"] .stat-card .stat-value { color: #c46475; }
        [data-theme="dark"] .card-header.bg-maroon {
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        /* Team toggle button */
        .team-toggle {
            background: none; border: 2px solid rgba(255,255,255,0.3); color: rgba(255,255,255,0.85);
            font-size: 0.75rem; cursor: pointer; padding: 0.3rem 0.6rem; border-radius: 20px;
            font-weight: 600; letter-spacing: 0.5px; transition: all 0.2s;
        }
        .team-toggle:hover { border-color: rgba(255,255,255,0.7); color: white; }
        [data-team="auburn"] .team-toggle { border-color: #DD550C; color: #DD550C; }
        [data-team="auburn"] .team-toggle:hover { background-color: #DD550C; color: white; }
        
        @media (max-width: 576px) {
            .stat-card .stat-value { font-size: 1.4rem; }
            .stat-card .stat-label { font-size: 0.7rem; }
            .navbar .nav-link { padding: 0.4rem 0.75rem !important; font-size: 0.9rem; }
            .fs-2 { font-size: 1.5rem !important; }
        }
        
        /* Footer */
        .footer {
            background-color: var(--navbar-bg);
            color: rgba(255,255,255,0.6);
            padding: 1.5rem 0;
            margin-top: 3rem;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-trophy-fill icon"></i>
                Baseball Predictor
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}" href="/" id="dashboardLink">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'teams' %}active{% endif %}" href="/teams">
                            <i class="bi bi-people"></i> Teams
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'predict' %}active{% endif %}" href="/predict">
                            <i class="bi bi-calculator"></i> Predict
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'rankings' %}active{% endif %}" href="/rankings">
                            <i class="bi bi-list-ol"></i> Rankings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'betting' %}active{% endif %}" href="/betting">
                            <i class="bi bi-currency-dollar"></i> Betting
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'calendar' %}active{% endif %}" href="/calendar">
                            <i class="bi bi-calendar3"></i> Calendar
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if request.endpoint in ('tracker', 'models', 'debug') %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots"></i> More
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/tracker"><i class="bi bi-graph-up-arrow"></i> P&L Tracker</a></li>
                            <li><a class="dropdown-item" href="/models"><i class="bi bi-gear"></i> Models</a></li>
                            <li><a class="dropdown-item" href="/debug"><i class="bi bi-bug"></i> Debug</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="toggleTeam(); return false;"><i class="bi bi-arrow-left-right"></i> Switch to <span id="teamToggleSwitchTo">Auburn</span></a></li>
                            <li><a class="dropdown-item" href="#" onclick="toggleDarkMode(); return false;"><i class="bi bi-moon-fill" id="darkModeIcon"></i> <span id="darkModeLabel">Dark Mode</span></a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container text-center">
            <small>College Baseball Predictor &copy; 2026 | Built with Flask & Bootstrap</small>
        </div>
    </footer>

    <!-- Bug Report Button -->
    <button class="btn btn-sm" onclick="openBugReport()" 
            style="position:fixed; bottom:20px; right:20px; z-index:1050; border-radius:50%; width:48px; height:48px; background:#dc3545; color:white; box-shadow:0 2px 8px rgba(0,0,0,0.3); font-size:1.2em;"
            title="Report a bug">
        <i class="bi bi-bug"></i>
    </button>
    
    <!-- Bug Report Modal -->
    <div class="modal fade" id="bugReportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-bug"></i> Report a Bug</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea class="form-control" id="bugDescription" rows="3" placeholder="What's wrong? Be specific..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="submitBug()">
                        <i class="bi bi-send"></i> Submit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dark Mode -->
    <script>
    function toggleDarkMode() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        updateIcon(next);
    }
    function updateIcon(theme) {
        const icon = document.getElementById('darkModeIcon');
        if (icon) {
            icon.className = theme === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
        }
        const label = document.getElementById('darkModeLabel');
        if (label) label.textContent = theme === 'dark' ? 'Light Mode' : 'Dark Mode';
    }
    // Bug report
    function openBugReport() {
        new bootstrap.Modal(document.getElementById('bugReportModal')).show();
    }
    function submitBug() {
        const desc = document.getElementById('bugDescription').value.trim();
        if (!desc) return;
        fetch('/api/bug-report', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({description: desc, page: window.location.pathname})
        }).then(r => r.json()).then(data => {
            if (data.ok) {
                bootstrap.Modal.getInstance(document.getElementById('bugReportModal')).hide();
                document.getElementById('bugDescription').value = '';
                alert('Bug reported! (#' + data.id + ')');
            }
        });
    }
    
    // Team toggle
    const TEAM_CONFIG = {
        'mississippi-state': { label: 'MSU', next: 'auburn' },
        'auburn': { label: 'AUB', next: 'mississippi-state' }
    };
    
    function toggleTeam() {
        const current = localStorage.getItem('featured_team') || 'mississippi-state';
        const next = TEAM_CONFIG[current]?.next || 'mississippi-state';
        localStorage.setItem('featured_team', next);
        document.documentElement.setAttribute('data-team', next);
        updateTeamLabel(next);
        const dashLink = document.getElementById('dashboardLink');
        if (dashLink) dashLink.href = '/?team=' + next;
        // Reload dashboard if we're on it to swap featured team
        if (window.location.pathname === '/') {
            window.location.href = '/?team=' + next;
        }
    }
    
    function updateTeamLabel(team) {
        const nextTeam = TEAM_CONFIG[team]?.next || 'auburn';
        const switchLabel = document.getElementById('teamToggleSwitchTo');
        if (switchLabel) {
            switchLabel.textContent = nextTeam === 'auburn' ? 'Auburn' : 'Mississippi State';
        }
    }
    
    // Load saved preferences
    (function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateIcon(savedTheme);
        
        // Check URL param first (overrides localStorage)
        const urlTeam = new URLSearchParams(window.location.search).get('team');
        const savedTeam = urlTeam || localStorage.getItem('featured_team') || 'mississippi-state';
        if (urlTeam) localStorage.setItem('featured_team', urlTeam);
        document.documentElement.setAttribute('data-team', savedTeam);
        updateTeamLabel(savedTeam);
        // Update dashboard link to include team preference
        const dashLink = document.getElementById('dashboardLink');
        if (dashLink) dashLink.href = '/?team=' + savedTeam;
    })();
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
